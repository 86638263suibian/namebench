Author: Jon Colverson <jon%colverson.co.uk>

This code was originally posted at http://stackoverflow.com/a/4066624
